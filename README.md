# Mood API - Сервис анализа настроения текста

Mood API - это сервис для анализа эмоциональной окраски текста. Сервис использует модель машинного обучения для определения настроения текста и возвращает оценку с указанием уверенности.

## Endpoints

Сервис предоставляет следующие endpoints:

### 1. Анализ настроения текста

**Endpoint:** `POST /api/v1/analyze`

**Content-Type:** `application/json`

**Тело запроса:**
```json
{
    "text": "Ваш текст для анализа"
}
```

**Пример ответа:**
```json
{
    "sentiment": "Very Positive",
    "score": 0.8534
}
```

Где:
- `sentiment` - оценка настроения текста:
  - `Very Positive` - очень позитивное
  - `Positive` - позитивное
  - `Neutral` - нейтральное
  - `Negative` - негативное
  - `Very Negative` - очень негативное
- `score` - уверенность модели в оценке (от 0 до 1):
  - Значения ближе к 1.0 означают высокую уверенность
  - Значения около 0.5 означают среднюю уверенность
  - Чем ближе к 0, тем ниже уверенность

### 2. Проверка работоспособности сервиса

**Endpoint:** `GET /api/v1/health`

**Пример ответа:**
```json
{
    "status": "OK"
}
```

## Примеры использования

### Использование curl

1. Проверка работоспособности:
```bash
curl http://localhost:8080/api/v1/health
```

2. Анализ текста:
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{"text":"Я очень рад сегодня!"}' \
  http://localhost:8080/api/v1/analyze
```

### Использование Postman

1. Проверка работоспособности (Health Check):
   - Метод: `GET`
   - URL: `http://localhost:8080/api/v1/health`
   - Не требует дополнительных заголовков или тела запроса

2. Анализ текста:
   - Метод: `POST`
   - URL: `http://localhost:8080/api/v1/analyze`
   - Заголовки:
     - Key: `Content-Type`
     - Value: `application/json`
   - Body:
     - Выберите тип `raw`
     - Выберите формат `JSON`
     - Введите:
     ```json
     {
         "text": "Ваш текст для анализа"
     }
     ```

### Использование Postman для удаленного доступа

1. Проверка работоспособности (Health Check):
   - Метод: `GET`
   - URL: `http://<IP-адрес-сервера>:8080/api/v1/health`
   - Не требует дополнительных заголовков или тела запроса

2. Анализ текста:
   - Метод: `POST`
   - URL: `http://<IP-адрес-сервера>:8080/api/v1/analyze`
   - Заголовки:
     - Key: `Content-Type`
     - Value: `application/json`
   - Body:
     - Выберите тип `raw`
     - Выберите формат `JSON`
     - Введите:
     ```json
     {
         "text": "Ваш текст для анализа"
     }
     ```

Где `<IP-адрес-сервера>` нужно заменить на реальный IP-адрес вашего сервера.

Пример для текущего сервера:
```
http://185.212.148.199:8080/api/v1/analyze
```

#### Настройка Postman для удаленного доступа:

1. Откройте Postman
2. Создайте новую коллекцию (New Collection)
3. Добавьте новый запрос (New Request)
4. В поле URL введите полный адрес с IP сервера
5. Выберите соответствующий метод (GET или POST)
6. Для POST запроса:
   - Перейдите во вкладку "Body"
   - Выберите "raw"
   - В выпадающем списке справа выберите "JSON"
   - Введите тело запроса в формате JSON

#### Советы по работе с удаленным API:

1. Убедитесь, что порт 8080 открыт на сервере
2. Проверьте доступность сервера через ping
3. Сначала проверьте endpoint /health для подтверждения работоспособности сервиса
4. При возникновении ошибок проверьте:
   - Правильность IP-адреса
   - Правильность порта
   - Корректность JSON-формата в теле запроса
   - Наличие всех необходимых заголовков

## Коды ответов

- `200 OK` - запрос успешно обработан
- `400 Bad Request` - неверный формат запроса
- `500 Internal Server Error` - внутренняя ошибка сервера

## Ограничения

1. Поле `text` не может быть пустым
2. Рекомендуется использовать тексты на русском или английском языках
3. Для получения более точных результатов рекомендуется использовать тексты длиной от 3 до 500 слов

## Примеры запросов и ответов

### Позитивный текст

**Запрос:**
```json
{
    "text": "Я очень рад сегодня!"
}
```

**Ответ:**
```json
{
    "sentiment": "Very Positive",
    "score": 0.8534
}
```

### Негативный текст

**Запрос:**
```json
{
    "text": "Это был ужасный день."
}
```

**Ответ:**
```json
{
    "sentiment": "Very Negative",
    "score": 0.7645
}
```

### Нейтральный текст

**Запрос:**
```json
{
    "text": "Сегодня обычный день."
}
```

**Ответ:**
```json
{
    "sentiment": "Neutral",
    "score": 0.6123
}
```

## Технический стек

- Go
- Gin (веб-фреймворк)
- Docker
- ML-модель для анализа настроения

## Установка и запуск

### Требования

- Go 1.16 или выше
- Docker и Docker Compose (опционально)

### Локальный запуск

1. Клонируйте репозиторий:
```bash
git clone [url-репозитория]
cd mood
```

2. Установите зависимости:
```bash
go mod download
```

3. Создайте файл `.env` на основе `app.env`:
```bash
cp app.env .env
```

4. Запустите сервис:
```bash
go run .
```

### Запуск через Docker

```bash
docker-compose up --build
```

## API Endpoints

### 1. Анализ настроения
```
POST /api/v1/analyze
```

**Запрос:**
```json
{
    "text": "Текст для анализа"
}
```

**Ответ:**
```json
{
    "sentiment": "positive",
    "created_at": 1647523200,
    "score": 0.85
}
```

### 2. Проверка здоровья
```
GET /api/v1/health
```

**Ответ:**
```json
{
    "status": "ok"
}
```

### 3. Прямой вызов ML-модели
```
POST /api/v1/model
```

## Конфигурация

Сервис настраивается через переменные окружения в файле `.env`:

- `PORT` - порт для запуска сервера (по умолчанию: 8080)
- `ML_MODEL_URL` - URL эндпоинта ML-модели

## Структура проекта

```
.
├── main.go          # Точка входа приложения
├── service.go       # Бизнес-логика
├── handler.go       # HTTP-обработчики
├── model.go         # Модели данных
├── config.go        # Конфигурация
├── docker-compose.yaml
└── ml_mood/         # ML-модель
```

## Разработка

### Добавление новых функций

1. Добавьте новые модели в `model.go`
2. Реализуйте бизнес-логику в `service.go`
3. Создайте обработчики в `handler.go`
4. Добавьте новые маршруты в `setupRouter` в `main.go`

### Тестирование

```bash
go test ./...
```

## Внесение изменений в проект

### Как внести свой вклад

1. Создайте форк репозитория
2. Создайте ветку для ваших изменений:
   ```bash
   git checkout -b feature/название-функции
   ```
3. Внесите изменения и зафиксируйте их:
   ```bash
   git add .
   git commit -m "Описание изменений"
   ```
4. Отправьте изменения в ваш форк:
   ```bash
   git push origin feature/название-функции
   ```
5. Создайте Pull Request в основной репозиторий

### Правила оформления кода

1. Используйте `gofmt` для форматирования Go кода
2. Добавляйте комментарии к публичным функциям и структурам
3. Обновляйте документацию при внесении изменений
4. Добавляйте тесты для новой функциональности

### Запуск тестов

```bash
# Запуск всех тестов
go test ./...

# Запуск тестов с покрытием
go test ./... -cover
```

### Сборка проекта

```bash
# Локальная сборка
go build

# Сборка Docker образа
docker build -t mood-api .
```

### Запуск в Docker

```bash
# Запуск всех сервисов
docker compose up --build

# Запуск в фоновом режиме
docker compose up -d --build

# Остановка сервисов
docker compose down
```

## Лицензия

MIT

## Авторы

- [Ваше имя] - [ваш email]

## Поддержка

Если у вас есть вопросы или предложения, создайте issue в репозитории проекта. 